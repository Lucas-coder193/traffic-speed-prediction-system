2025-09-18 23:49:20,902 - TrafficPrediction - INFO - === 交通车辆速度预测应用系统 ===
2025-09-18 23:49:20,902 - TrafficPrediction - INFO - 当前模式: train
2025-09-18 23:49:20,902 - TrafficPrediction - INFO - 开始模型训练...
2025-09-18 23:49:21,116 - numexpr.utils - INFO - Note: NumExpr detected 32 cores but "NUMEXPR_MAX_THREADS" not set, so enforcing safe limit of 8.
2025-09-18 23:49:21,116 - numexpr.utils - INFO - NumExpr defaulting to 8 threads.
2025-09-18 23:49:24,839 - src.model_training - INFO - 开始训练模型: gcn_gru_fuzzy, 数据集: Los-loop
2025-09-18 23:49:24,840 - src.model_training - INFO - 加载数据集: Los-loop
2025-09-18 23:49:25,156 - src.model_training - INFO - 已加载预训练的标准化器
2025-09-18 23:49:25,156 - src.model_training - INFO - 数据集加载完成: X形状=(32111, 12, 207), y形状=(32111, 207), 外部特征形状=(32111, 207, 10), 邻接矩阵形状=(207, 207)
2025-09-18 23:49:25,156 - src.model_training - INFO - 划分数据集...
2025-09-18 23:49:25,650 - src.model_training - INFO - 训练集大小: 19266
2025-09-18 23:49:25,650 - src.model_training - INFO - 验证集大小: 6422
2025-09-18 23:49:25,650 - src.model_training - INFO - 测试集大小: 6423
2025-09-18 23:49:25,701 - src.model_training - INFO - 创建模型，节点数: 207, 隐藏层大小: 64
2025-09-18 23:49:25,702 - src.model_structure - INFO - 创建模型: 节点数=207, 时间步=12, 隐藏层大小=64
2025-09-18 23:49:25,703 - TrafficPrediction - INFO - 初始化模糊推理系统...
2025-09-18 23:49:25,747 - src.model_structure - INFO - SpatioTemporalGCNGRU.call() called with inputs type: <class 'list'>
2025-09-18 23:49:25,748 - src.model_structure - INFO - Training mode: False
2025-09-18 23:49:25,748 - src.model_structure - INFO - Inputs is list/tuple with length: 3
2025-09-18 23:49:25,748 - src.model_structure - INFO - Speed sequences shape: (None, 12, 207)
2025-09-18 23:49:25,748 - src.model_structure - INFO - Adjacency matrix shape: (None, 207, 207)
2025-09-18 23:49:25,749 - src.model_structure - INFO - External features shape: (None, 207, 10)
2025-09-18 23:49:25,824 - src.model_structure - INFO - Predictions shape: (None, 207)
2025-09-18 23:49:25,832 - src.model_structure - INFO - 模型结构摘要:
2025-09-18 23:49:25,847 - src.model_structure - INFO - Model: "functional"
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Layer (type)                  ┃ Output Shape             ┃          Param # ┃ Connected to              ┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━┩
│ input_layer_1 (InputLayer)    │ (None, 207, 207)         │                0 │ -                         │
├───────────────────────────────┼──────────────────────────┼──────────────────┼───────────────────────────┤
│ input_layer (InputLayer)      │ (None, 12, 207)          │                0 │ -                         │
├───────────────────────────────┼──────────────────────────┼──────────────────┼───────────────────────────┤
│ expand_dims_1 (ExpandDims)    │ (None, 1, 207, 207)      │                0 │ input_layer_1[0][0]       │
├───────────────────────────────┼──────────────────────────┼──────────────────┼───────────────────────────┤
│ expand_dims (ExpandDims)      │ (None, 12, 207, 1)       │                0 │ input_layer[0][0]         │
├───────────────────────────────┼──────────────────────────┼──────────────────┼───────────────────────────┤
│ tile (Tile)                   │ (None, 12, 207, 207)     │                0 │ expand_dims_1[0][0]       │
├───────────────────────────────┼──────────────────────────┼──────────────────┼───────────────────────────┤
│ reshape (Reshape)             │ (None, 207, 1)           │                0 │ expand_dims[0][0]         │
├───────────────────────────────┼──────────────────────────┼──────────────────┼───────────────────────────┤
│ reshape_1 (Reshape)           │ (None, 207, 207)         │                0 │ tile[0][0]                │
├───────────────────────────────┼──────────────────────────┼──────────────────┼───────────────────────────┤
│ gcn_layer (GCNLayer)          │ (None, 207, 32)          │               64 │ reshape[0][0],            │
│                               │                          │                  │ reshape_1[0][0]           │
├───────────────────────────────┼──────────────────────────┼──────────────────┼───────────────────────────┤
│ batch_normalization           │ (None, 207, 32)          │              128 │ gcn_layer[0][0]           │
│ (BatchNormalization)          │                          │                  │                           │
├───────────────────────────────┼──────────────────────────┼──────────────────┼───────────────────────────┤
│ gcn_layer_1 (GCNLayer)        │ (None, 207, 32)          │            1,056 │ batch_normalization[0][0… │
│                               │                          │                  │ reshape_1[0][0]           │
├───────────────────────────────┼──────────────────────────┼──────────────────┼───────────────────────────┤
│ input_layer_2 (InputLayer)    │ (None, 207, 10)          │                0 │ -                         │
├───────────────────────────────┼──────────────────────────┼──────────────────┼───────────────────────────┤
│ batch_normalization_1         │ (None, 207, 32)          │              128 │ gcn_layer_1[0][0]         │
│ (BatchNormalization)          │                          │                  │                           │
├───────────────────────────────┼──────────────────────────┼──────────────────┼───────────────────────────┤
│ mean (Mean)                   │ (None, 10)               │                0 │ input_layer_2[0][0]       │
├───────────────────────────────┼──────────────────────────┼──────────────────┼───────────────────────────┤
│ reshape_2 (Reshape)           │ (None, 12, 207, 32)      │                0 │ batch_normalization_1[0]… │
├───────────────────────────────┼──────────────────────────┼──────────────────┼───────────────────────────┤
│ dense (Dense)                 │ (None, 64)               │              704 │ mean[0][0]                │
├───────────────────────────────┼──────────────────────────┼──────────────────┼───────────────────────────┤
│ dropout (Dropout)             │ (None, 128)              │                0 │ dense[0][0],              │
│                               │                          │                  │ dense_2[0][0]             │
├───────────────────────────────┼──────────────────────────┼──────────────────┼───────────────────────────┤
│ reshape_3 (Reshape)           │ (None, 12, 6624)         │                0 │ reshape_2[0][0]           │
├───────────────────────────────┼──────────────────────────┼──────────────────┼───────────────────────────┤
│ gru (GRU)                     │ (None, 12, 64)           │        1,284,480 │ reshape_3[0][0]           │
├───────────────────────────────┼──────────────────────────┼──────────────────┼───────────────────────────┤
│ dense_1 (Dense)               │ (None, 32)               │            2,080 │ dropout[0][0]             │
├───────────────────────────────┼──────────────────────────┼──────────────────┼───────────────────────────┤
│ gru_1 (GRU)                   │ (None, 64)               │           24,960 │ gru[0][0]                 │
├───────────────────────────────┼──────────────────────────┼──────────────────┼───────────────────────────┤
│ batch_normalization_2         │ (None, 32)               │              128 │ dense_1[0][0]             │
│ (BatchNormalization)          │                          │                  │                           │
├───────────────────────────────┼──────────────────────────┼──────────────────┼───────────────────────────┤
│ concatenate (Concatenate)     │ (None, 96)               │                0 │ gru_1[0][0],              │
│                               │                          │                  │ batch_normalization_2[0]… │
├───────────────────────────────┼──────────────────────────┼──────────────────┼───────────────────────────┤
│ dense_2 (Dense)               │ (None, 128)              │           12,416 │ concatenate[0][0]         │
├───────────────────────────────┼──────────────────────────┼──────────────────┼───────────────────────────┤
│ dense_3 (Dense)               │ (None, 64)               │            8,256 │ dropout[1][0]             │
├───────────────────────────────┼──────────────────────────┼──────────────────┼───────────────────────────┤
│ dense_4 (Dense)               │ (None, 207)              │           13,455 │ dense_3[0][0]             │
└───────────────────────────────┴──────────────────────────┴──────────────────┴───────────────────────────┘
 Total params: 1,347,855 (5.14 MB)
 Trainable params: 1,347,663 (5.14 MB)
 Non-trainable params: 192 (768.00 B)

2025-09-18 23:49:25,851 - src.model_training - INFO - 初始化模糊推理系统...
2025-09-18 23:49:25,851 - TrafficPrediction - INFO - 初始化模糊推理系统...
2025-09-18 23:49:25,851 - src.model_training - INFO - 模型目录已创建: D:\大三夏季学期\交通车辆速度预测应用系统\models
2025-09-18 23:49:25,852 - src.model_training - INFO - 临时禁用TensorBoard回调，使用TrainingVisualizer代替
2025-09-18 23:49:25,853 - gcn_gru_fuzzy_Los-loop_visualizer - INFO - 开始训练模型: gcn_gru_fuzzy，数据集: Los-loop，总轮次: 50
2025-09-18 23:49:25,853 - src.model_training - INFO - 开始模型训练，共50轮
2025-09-18 23:50:38,385 - src.model_training - INFO - 轮次 1/50: 损失=0.170102, 验证损失=0.050231, 损失变化率=nan%, MAE=0.156866, 验证MAE=0.139334, RMSE=0.239016, 验证RMSE=0.193492, 平滑损失=0.170102 [最佳] [有效]
2025-09-18 23:50:38,386 - gcn_gru_fuzzy_Los-loop_visualizer - INFO - Epoch 1 完成: 训练损失=0.170102, 验证损失=0.050231, 损失变化率=0.00%
2025-09-18 23:51:44,480 - src.model_training - INFO - 轮次 2/50: 损失=0.034099, 验证损失=0.030119, 损失变化率=79.95%, MAE=0.102733, 验证MAE=0.107830, RMSE=0.167312, 验证RMSE=0.164413, 平滑损失=0.034099 [最佳] [有效]
2025-09-18 23:51:44,481 - gcn_gru_fuzzy_Los-loop_visualizer - INFO - Epoch 2 完成: 训练损失=0.034099, 验证损失=0.030119, 损失变化率=79.95%
2025-09-18 23:52:55,259 - src.model_training - INFO - 轮次 3/50: 损失=0.029240, 验证损失=0.028200, 损失变化率=14.25%, MAE=0.095686, 验证MAE=0.095874, RMSE=0.163054, 验证RMSE=0.160591, 平滑损失=0.029240 [最佳] [有效]
2025-09-18 23:52:55,261 - gcn_gru_fuzzy_Los-loop_visualizer - INFO - Epoch 3 完成: 训练损失=0.029240, 验证损失=0.028200, 损失变化率=14.25%
